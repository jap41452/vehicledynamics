<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Vehicle Geometry + Simple Road Features</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js"
  }
}
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
body {
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:#eaeaea;
}
#container {
  display:flex;
  height:100vh;
}
#ui {
  width:300px;
  padding:10px;
  background:#fff;
  border-right:1px solid #ccc;
  box-sizing:border-box;
  overflow-y:auto;
}
#viewer {
  flex:1;
}
h2 { font-size:14px; margin:0 0 8px 0; }
h3 { font-size:12px; margin:12px 0 6px 0; border-bottom:1px solid #ddd; }
.grid2 {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px 8px;
}
label { font-size:11px; }
input {
  width:100%;
  padding:4px;
  font-size:11px;
  box-sizing:border-box;
}
button {
  width:100%;
  margin-top:8px;
  padding:6px;
  font-size:12px;
}
.feature {
  font-size:11px;
  margin:4px 0;
}
</style>
</head>

<body>
<div id="container">

<!-- UI -->
<div id="ui">
  <h2>Vehicle Geometry</h2>

  <h3>Box 1</h3>
  <div class="grid2">
    <label>Length Y<input id="box1_L" value="120"></label>
    <label>Width X<input id="box1_W" value="72"></label>
    <label>Height Z<input id="box1_H" value="24"></label>
    <label>Weight<input id="box1_Wt" value="2500"></label>
  </div>

  <h3>Wheels</h3>
  <div class="grid2">
    <label>Diameter<input id="wheel_D" value="32"></label>
    <label>Front Y<input id="wheel_Yf" value="-20"></label>
    <label>Rear Spacing<input id="wheel_dYr" value="80"></label>
  </div>

  <button id="updateVehicle">Update Vehicle</button>

  <h3>Road Features</h3>
  <button id="addBump">Add Speed Bump</button>
  <button id="addHole">Add Pothole</button>

  <h3>Existing</h3>
  <div id="featureList"></div>
</div>

<div id="viewer"></div>
</div>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from
  'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';

let scene, camera, renderer, controls;
let vehicleGroup = new THREE.Group();
let groundGroup = new THREE.Group();
let features = [];
let nextId = 1;

init();
buildVehicle();
animate();

function init() {
  THREE.Object3D.DEFAULT_UP.set(0,0,1);

  scene = new THREE.Scene();
  scene.background = new THREE.Color(0xf0f0f0);

  camera = new THREE.PerspectiveCamera(45,1,0.1,5000);
  camera.position.set(300,-400,250);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(viewer.clientWidth,viewer.clientHeight);
  viewer.appendChild(renderer.domElement);

  controls = new OrbitControls(camera,renderer.domElement);
  controls.target.set(0,-60,20);
  controls.update();

  scene.add(new THREE.AmbientLight(0xffffff,0.6));
  const d = new THREE.DirectionalLight(0xffffff,0.8);
  d.position.set(200,-200,300);
  scene.add(d);

  scene.add(vehicleGroup);
  scene.add(groundGroup);

  // Ground plane as a BOX (not plane)
  const ground = new THREE.Mesh(
    new THREE.BoxGeometry(600,600,2),
    new THREE.MeshStandardMaterial({color:0xcccccc})
  );
  ground.position.z = -1;
  groundGroup.add(ground);

  window.addEventListener('resize',()=>{
    camera.aspect = viewer.clientWidth/viewer.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(viewer.clientWidth,viewer.clientHeight);
  });
}

function buildVehicle() {
  vehicleGroup.clear();

  const L = +box1_L.value;
  const W = +box1_W.value;
  const H = +box1_H.value;
  const R = +wheel_D.value / 2;

  const body = new THREE.Mesh(
    new THREE.BoxGeometry(W,L,H),
    new THREE.MeshStandardMaterial({color:0x555555})
  );
  body.position.set(0,-L/2,H/2+R);
  vehicleGroup.add(body);

  const wheelGeom = new THREE.CylinderGeometry(R,R,4,32);
  const wheelMat = new THREE.MeshStandardMaterial({color:0x000000});

  const yF = +wheel_Yf.value;
  const yR = yF - +wheel_dYr.value;
  const xOff = W/2;

  [[-xOff,yF],[xOff,yF],[-xOff,yR],[xOff,yR]].forEach(([x,y])=>{
    const w = new THREE.Mesh(wheelGeom,wheelMat);
    w.rotation.z = Math.PI/2;
    w.position.set(x,y,R);
    vehicleGroup.add(w);
  });
}

updateVehicle.onclick = buildVehicle;

/* ---------- SPEED BUMP (BOX) ---------- */
addBump.onclick = ()=>{
  Swal.fire({
    title:'Speed Bump',
    html:`
      <label>Height<input id="h" value="3"></label><br>
      <label>Length Y<input id="l" value="24"></label><br>
      <label>Start from front<input id="y" value="60"></label>
    `,
    preConfirm:()=>({h:+h.value,l:+l.value,y:+y.value})
  }).then(r=>r.value && addSpeedBump(r.value));
};

function addSpeedBump({h,l,y}) {
  const W = +box1_W.value;
  const L = +box1_L.value;

  const bump = new THREE.Mesh(
    new THREE.BoxGeometry(W,l,h),
    new THREE.MeshStandardMaterial({color:0x888888})
  );

  bump.position.set(
    0,
    -L/2 + y + l/2,
    h/2
  );

  groundGroup.add(bump);
  registerFeature('Speed Bump', bump);
}

/* ---------- POTHOLE (BOX) ---------- */
addHole.onclick = ()=>{
  Swal.fire({
    title:'Pothole',
    html:`
      <label>Depth<input id="d" value="2"></label><br>
      <label>Length Y<input id="l" value="18"></label><br>
      <label>Start from front<input id="y" value="48"></label>
    `,
    preConfirm:()=>({d:+d.value,l:+l.value,y:+y.value})
  }).then(r=>r.value && addPothole(r.value));
};

function addPothole({d,l,y}) {
  const L = +box1_L.value;

  const hole = new THREE.Mesh(
    new THREE.BoxGeometry(20,l,d),
    new THREE.MeshStandardMaterial({color:0x666666})
  );

  hole.position.set(
    0,
    -L/2 + y + l/2,
    -d/2
  );

  groundGroup.add(hole);
  registerFeature('Pothole', hole);
}

/* ---------- FEATURE LIST ---------- */
function registerFeature(name, mesh) {
  const id = nextId++;
  features.push({id,name,mesh});
  refreshList();
}

function refreshList() {
  featureList.innerHTML = '';
  features.forEach(f=>{
    const div = document.createElement('div');
    div.className = 'feature';
    div.innerHTML = `${f.name}
      <button onclick="removeFeature(${f.id})">Delete</button>`;
    featureList.appendChild(div);
  });
}

window.removeFeature = id => {
  const i = features.findIndex(f=>f.id===id);
  if (i>=0) {
    groundGroup.remove(features[i].mesh);
    features.splice(i,1);
    refreshList();
  }
};

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene,camera);
}
</script>

</body>
</html>












